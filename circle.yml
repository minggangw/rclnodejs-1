machine:
  xcode:
    version: 8.3.3

dependencies:
  pre:
    - csrutil status
    - brew update
    - brew doctor
    - brew install python3 cmake wget cppcheck tinyxml eigen pcre
    - brew install asio tinyxml2
    - brew install opencv
    - brew install openssl
    - python3 -m pip install pyyaml setuptools argcomplete
    - cd ~/Downloads && wget http://ci.ros2.org/view/packaging/job/packaging_osx/lastSuccessfulBuild/artifact/ws/ros2-package-osx-x86_64.tar.bz2
    - mkdir -p ~/ros2_install && cd ~/ros2_install && tar xf ~/Downloads/ros2-package-osx-x86_64.tar.bz2
    - wget -qO- https://raw.githubusercontent.com/creationix/nvm/v0.33.2/install.sh | bash
    - nvm install v6.11.4
    - nvm use v6.11.4

  override:
    - source $HOME/ros2_install/ros2-osx/local_setup.bash && npm install && npm run lint

test:
  override:
    - source $HOME/ros2_install/ros2-osx/local_setup.bash && node scripts/run_test.js
